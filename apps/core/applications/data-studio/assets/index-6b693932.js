import{r as e,u as i,j as t}from"./useTranslation-6a88ac92.js";import{aB as n,ar as r,aW as a,aG as o,aF as s,ab as l,ao as d,aJ as c,aK as h,bc as v,ba as u,aN as g,bO as p,aP as m,aY as b,aV as f,aE as x,aD as y,bK as j,bm as w}from"./recordIdentityFragment-3ccdcea1.js";import{A as I,a2 as C,a0 as E}from"./utils-c614281c.js";import{r as $,t as k,aa as _,aQ as L,l as A,a6 as S,I as V,u as M,a5 as T,c as R,V as D,O as Q,K as z,aR as N,aS as F,ae as B,ag as O,d as H,X as W,Y as P,aT as K,R as G,aU as U,a as Y,aV as J,W as q,s as X,aW as Z}from"./index-135e49ab.js";import{R as ee,g as ie,E as te,S as ne,G as re,F as ae,a as oe,U as se,C as le,T as de,d as ce,b as he,c as ve,t as ue,e as ge}from"./LibraryItemsList-70530d6e.js";import{s as pe}from"./styled-components.browser.esm-2d72260f.js";import{j as me,B as be,bJ as fe,L as xe}from"./ImportReducerContext-19d27c8c.js";import"./index-8160faf7.js";import"./InboxOutlined-82488bac.js";const ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"};var je=function(i,t){return e.createElement(I,me({},i,{ref:t,icon:ye}))};const we=e.forwardRef(je);const Ie={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112c17.7 0 32 14.3 32 32v736c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32zm-40 72H184v656h656V184zM640.01 338.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-square",theme:"outlined"};var Ce=function(i,t){return e.createElement(I,me({},i,{ref:t,icon:Ie}))};const Ee=e.forwardRef(Ce);const $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"};var ke=function(i,t){return e.createElement(I,me({},i,{ref:t,icon:$e}))};const _e=e.forwardRef(ke);const Le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M920 760H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-568H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H336c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM216 712H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h72.4v20.5h-35.7c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h35.7V838H100c-2.2 0-4 1.8-4 4v34c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4V716c0-2.2-1.8-4-4-4zM100 188h38v120c0 2.2 1.8 4 4 4h40c2.2 0 4-1.8 4-4V152c0-4.4-3.6-8-8-8h-78c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4zm116 240H100c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4h68.4l-70.3 77.7a8.3 8.3 0 00-2.1 5.4V592c0 2.2 1.8 4 4 4h116c2.2 0 4-1.8 4-4v-36c0-2.2-1.8-4-4-4h-68.4l70.3-77.7a8.3 8.3 0 002.1-5.4V432c0-2.2-1.8-4-4-4z"}}]},name:"ordered-list",theme:"outlined"};var Ae=function(i,t){return e.createElement(I,me({},i,{ref:t,icon:Le}))};const Se=e.forwardRef(Ae),Ve=n`
    ${$}
    subscription TREE_EVENTS($filters: TreeEventFiltersInput) {
        treeEvent(filters: $filters) {
            type
            treeId
            element {
                id
                childrenCount
                record {
                    ...RecordIdentity
                }
                permissions {
                    access_tree
                    detach
                    edit_children
                }
            }
            parentNode {
                id
            }
            parentNodeBefore {
                id
            }
        }
    }
`,Me=pe.div`
    position: relative;
    min-width: ${r.navigationColumnWidth};
    max-width: ${r.navigationColumnWidth};

    display: grid;
    justify-items: center;
    word-break: break-all;

    background: ${r.defaultBg};
    border-right: 1px solid ${r.borderLightColor};
    border-bottom: 1px solid ${r.borderLightColor};
    padding: 1rem;
    box-shadow: 0 1 1rem red;

    .header-detail {
        width: 100%;
    }
`,Te=pe.div`
    display: flex;
    flex-flow: column nowrap;
    justify-content: start;
    gap: 0.5rem;
`,Re=pe.div`
    span {
        font-weight: 600;
    }
`,De=pe.div`
    padding: 2rem;
    width: 100%;
`,Qe=pe(a)`
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    font-size: 1.1em;
    cursor: pointer;
`,ze=({treeElement:e,closable:n,onClose:r})=>{var a,o,s;const{t:l}=i(),d=e.record,c=null==(o=null==(a=null==d?void 0:d.whoAmI)?void 0:a.preview)?void 0:o.file,h=d.whoAmI.label?d.whoAmI.label:l("navigation.list.info.no-label"),v=null==(s=d.whoAmI.preview)?void 0:s.big;return t.jsxs(Me,{"data-testid":"details-column",children:[n&&t.jsx(Qe,{onClick:r}),t.jsx(De,{children:t.jsx(ee,{previewFile:c,label:d.whoAmI.label?h:d.id,color:d.whoAmI.color,image:v&&_(v),tile:!0,placeholderStyle:{width:"10rem",height:"10rem"},imageStyle:{maxHeight:"15rem",maxWidth:"100%"}},d.id)}),t.jsxs(Te,{children:[t.jsxs(Re,{children:[t.jsxs("span",{children:[l("navigation.list.info.id"),":"]})," ",d.id]}),t.jsxs(Re,{children:[t.jsxs("span",{children:[l("navigation.list.info.label"),":"]})," ",h]})]})]})},Ne=(e,i)=>{var t,n,r;const{data:a,loading:s,error:l}=o(ie,{skip:!e,variables:{treeId:[e]}}),d=[];if(!s&&!l){const e=(null==(n=null==(t=null==a?void 0:a.trees)?void 0:t.list[0])?void 0:n.libraries)??[];if(i){const t=e.find((e=>e.library.id===i.record.whoAmI.library.id)),n="__all__"===(null==(r=null==t?void 0:t.settings.allowedChildren)?void 0:r[0]);d.push(...e.filter((e=>n||t.settings.allowedChildren.includes(e.library.id))))}else d.push(...e.filter((e=>e.settings.allowedAtRoot)))}return{loading:s,error:l,libraries:d}},Fe=pe.img`
    transform: translate(0px, -1px) rotate(90deg);
`,Be=()=>t.jsx("div",{children:t.jsx(Fe,{src: window.__dynamic_base__+"/assets/svgEllipsis-deefb4b1.svg",alt:"icon ellipsis vertical"})}),Oe=s`
    mutation REMOVE_TREE_ELEMENT($treeId: ID!, $nodeId: ID!, $deleteChildren: Boolean) {
        treeDeleteElement(treeId: $treeId, nodeId: $nodeId, deleteChildren: $deleteChildren)
    }
`,He=e=>{const i=l();return{refreshTreeContent(){i.refetchQueries({updateCache:i=>{const t=i.extract();Object.keys(t.ROOT_QUERY).filter((i=>i.match(new RegExp(`treeNodeChildren(.*)${e}`)))).forEach((e=>i.evict({fieldName:e}))),i.gc()}})}}},We=s`
    mutation ADD_TREE_ELEMENT($treeId: ID!, $element: TreeElementInput!, $parent: ID, $order: Int) {
        treeAddElement(treeId: $treeId, element: $element, parent: $parent, order: $order) {
            id
        }
    }
`;function Pe({availableLibraries:n,parent:r,onMessages:a}){var o;const{t:s}=i(),{lang:l}=d(),[u]=c(We),[g]=L(),{refreshTreeContent:p}=He(g.id),[m,b]=e.useState(),[f,x]=e.useState(!1),y=e=>()=>{x(!0),b(e)},j=t.jsx(v,{});return n.length?t.jsxs(t.Fragment,{children:[n.length>1?t.jsx(h,{menu:{items:n.map((e=>({key:e.library.id,onClick:y(e.library.id),label:A(e.library.label,l)})))},children:t.jsx(C,{title:s("navigation.header.add_by_creation"),placement:"top",children:t.jsx(be,{icon:j})})}):t.jsx(C,{title:s("navigation.header.add_by_creation"),placement:"top",children:t.jsx(be,{icon:j,"aria-label":"add-by-creation",onClick:y((null==(o=n[0])?void 0:o.library.id)??null)})}),f&&t.jsx(te,{open:f,library:m,record:null,onClose:()=>x(!1),afterCreate:async e=>{var i,t;let n,o={countValid:0,errors:{}};try{await u({variables:{treeId:g.id,element:{id:e.id,library:e.library.id},parent:(null==r?void 0:r.id)??null}}),o={...o,countValid:1},n={channel:S.trigger,type:V.success,content:s("navigation.notifications.success-add",{nb:1})}}catch(l){if(l.graphQLErrors&&l.graphQLErrors.length){const e=null==(i=l.graphQLErrors[0].extensions.fields)?void 0:i.parent,n=null==(t=l.graphQLErrors[0].extensions.fields)?void 0:t.element;e&&(o.errors[e]=[...o.errors[e]??[]]),n&&(o.errors[n]=[...o.errors[n]??[]])}else n={channel:S.trigger,type:V.error,content:`${l.message}`}}a("navigation.infos.success-add","navigation.infos.error-add",o),p()}})]}):null}function Ke({availableLibraries:n,parent:r,onMessages:a}){const{t:o}=i(),{lang:s}=d(),[l,v]=e.useState(!1),[u,g]=e.useState(),[p]=L(),m=M(),{refreshTreeContent:b}=He(p.id),[f]=c(We),x=e=>{g(e),v(!0)},y=t.jsx(re,{size:"1.2em"}),j={paddingTop:"5px"};return n.length?t.jsxs(t.Fragment,{children:[n.length>1?t.jsx(h,{menu:{items:n.map((e=>({key:e.library.id,onClick:()=>x(e.library.id),label:A(e.library.label,s)})))},children:t.jsx(C,{title:o("navigation.header.add_by_search"),placement:"top",children:t.jsx(be,{icon:y,style:j})})}):t.jsx(C,{title:o("navigation.header.add_by_search"),placement:"top",children:t.jsx(be,{icon:y,"aria-label":"add-by-search",onClick:()=>{var e;return x((null==(e=n[0])?void 0:e.library.id)??null)},style:j})}),l&&t.jsx(ne,{visible:l,setVisible:v,submitAction:async e=>{var i,t;if(e.selected.length){let o={countValid:0,errors:{}};for(const a of e.selected){const e={id:a.id,library:a.library};try{await f({variables:{treeId:p.id,element:e,parent:(null==r?void 0:r.id)??null}}),o={...o,countValid:o.countValid+1}}catch(n){if(n.graphQLErrors&&n.graphQLErrors.length){const e=null==(i=n.graphQLErrors[0].extensions.fields)?void 0:i.parent,r=null==(t=n.graphQLErrors[0].extensions.fields)?void 0:t.element;e&&(o.errors[e]=[...o.errors[e]??[],a.id]),r&&(o.errors[r]=[...o.errors[r]??[],a.label||a.id])}else m(T({channel:S.trigger,type:V.error,content:`${n.message}`}))}}a("navigation.infos.success-add","navigation.infos.error-add",o),b()}},libId:u})]}):null}function Ge({isDetail:n,parent:r,allowedChildrenLibraries:a,onMessages:o}){var s,l,d;const{t:v}=i(),p=M(),{selectionState:m,navigation:b}=R((e=>({selectionState:e.selection,navigation:e.navigation}))),f=!!m.selection.selected.length,[x]=L(),[y,j]=e.useState(!1),[w,I]=e.useState(!1),[C,$]=e.useState(!1),[k,_]=e.useState(!1),[A]=c(Oe),{refreshTreeContent:B}=He(x.id),O=r?r.permissions.edit_children:x.permissions.edit_children,H=!!r&&r.permissions.detach,W=[{key:"upload",icon:t.jsx(D,{}),onClick:()=>$(!0),label:v("upload.title"),displayCondition:x.behavior===fe.files&&(!r||(null==r?void 0:r.record.whoAmI.library.behavior)===xe.directories)},{key:"create_directory",icon:t.jsx(ae,{}),onClick:()=>_(!0),label:v("create_directory.title"),displayCondition:x.behavior===fe.files&&(!r||(null==r?void 0:r.record.whoAmI.library.behavior)===xe.directories)},{key:"details",icon:t.jsx(Q,{}),onClick:()=>{const e=b.path.findIndex((e=>e.id===(null==r?void 0:r.id))),i=[...b.path];i[e]={...r,showDetails:!0},p(F(i))},label:v("navigation.actions.details"),displayCondition:!!r&&!n},{key:"edit",icon:t.jsx(u,{}),onClick:()=>I(!0),label:v("navigation.actions.edit"),displayCondition:!!r},{key:"classified_in",icon:t.jsx(oe,{}),onClick:()=>E.warning(v("global.feature_not_available")),label:v("navigation.actions.classified_in"),displayCondition:!0},{label:v("files.generate_previews"),icon:t.jsx(g,{}),onClick:()=>{j(!0)},displayCondition:x.behavior===fe.files},{key:"divider",type:"divider",displayCondition:O},{key:"order",icon:t.jsx(Se,{}),onClick:()=>E.warning(v("global.feature_not_available")),label:v("navigation.actions.order"),displayCondition:O},{key:"detach",icon:t.jsx(z,{}),onClick:async()=>{const e=r.record.whoAmI.label;let i;try{await A({variables:{treeId:x.id,nodeId:(null==r?void 0:r.id)??null}}),i={channel:S.trigger,type:V.success,content:v("navigation.infos.success-detach",{nb:1})}}catch(t){i={channel:S.trigger,type:V.error,content:v("navigation.infos.error-detach",{elementName:e??r.record.id,errorMessage:t.message})}}p(T(i)),B()},label:v("navigation.actions.detach"),displayCondition:O&&H}].reduce(((e,i)=>{if(i.displayCondition){const{displayCondition:t,...n}=i;e.push(n)}return e}),[]),P=N(x);return t.jsxs(t.Fragment,{children:[C&&t.jsx(se,{defaultSelectedNode:{id:(null==r?void 0:r.id)||x.id,recordId:null==r?void 0:r.record.id},libraryId:x.libraries.filter((e=>e.behavior===xe.files))[0].id,multiple:!0,onClose:()=>$(!1),onCompleted:()=>{B()}}),k&&t.jsx(le,{defaultSelectedKey:(null==r?void 0:r.id)||x.id,libraryId:(null==r?void 0:r.record.whoAmI.library.id)||x.libraries.filter((e=>e.behavior===xe.directories))[0].id,onClose:()=>_(!1),onCompleted:()=>{B()}}),w&&t.jsx(te,{open:w,library:r.record.whoAmI.library.id,record:r.record.whoAmI,onClose:()=>I(!1)}),!f&&t.jsxs(t.Fragment,{children:[O&&t.jsxs(t.Fragment,{children:[t.jsx(Ke,{availableLibraries:a,parent:r,onMessages:o}),t.jsx(Pe,{availableLibraries:a,parent:r,onMessages:o})]}),t.jsx("span",{"data-testid":"dropdown-tree-actions",children:t.jsx(h,{placement:"bottomRight",menu:{items:W},children:t.jsx(be,{icon:t.jsx(Be,{})})})})]}),y&&t.jsx(de,{libraryId:null==(d=null==(l=null==(s=null==r?void 0:r.record)?void 0:s.whoAmI)?void 0:l.library)?void 0:d.id,filesLibraryId:P,...r&&{recordIds:[null==r?void 0:r.record.id]},onClose:()=>{j(!1)}})]})}function Ue({allowedLibraries:e,parent:n,onMessages:r}){const{t:a}=i(),{selectionState:o}=R((e=>({selectionState:e.selection,navigation:e.navigation}))),s=M(),[l]=L(),[d]=c(We),{refreshTreeContent:h}=He(l.id);return o.selection.selected.some((i=>e.includes(i.library)))?t.jsx(be,{icon:t.jsx(v,{}),onClick:async()=>{var i,t;if(o.selection.selected.length){let a={countValid:0,errors:{}};const s=(null==n?void 0:n.id)??null,v=o.selection.selected.filter((i=>e.includes(i.library)));for(const e of v){const n={id:e.id,library:e.library};try{await d({variables:{treeId:l.id,element:n,parent:s}}),a={...a,countValid:a.countValid+1}}catch(c){if(c.graphQLErrors&&c.graphQLErrors.length){const n=null==(i=c.graphQLErrors[0].extensions.fields)?void 0:i.parent,r=null==(t=c.graphQLErrors[0].extensions.fields)?void 0:t.element;n&&(a.errors[n]=[...a.errors[n]??[],e.id]),r&&(a.errors[r]=[...a.errors[r]??[],e.label||e.id])}}}r("navigation.infos.success-add","navigation.infos.error-add",a),h()}else{const e={channel:S.trigger,type:V.warning,content:a("navigation.infos.warning-add-no-selection")};s(T(e))}s(B())},"aria-label":"add-selection",title:a("navigation.actions.add-selected")}):null}function Ye({onMessages:e}){const{t:n}=i(),{selectionState:r,navigation:a}=R((e=>({selectionState:e.selection,navigation:e.navigation}))),o=M(),[s]=L(),[l]=c(Oe),{refreshTreeContent:d}=He(s.id);return t.jsx(be,{onClick:async()=>{var i,t;const n={countValid:0,errors:{}},c=[];for(const e of r.selection.selected)try{await l({variables:{treeId:s.id,nodeId:e.nodeId}}),n.countValid++,c.push(e.nodeId)}catch(v){if(v.graphQLErrors&&v.graphQLErrors.length){const r=null==(i=v.graphQLErrors[0].extensions.fields)?void 0:i.parent,a=null==(t=v.graphQLErrors[0].extensions.fields)?void 0:t.element;r&&(n.errors[r]=[...n.errors[r]??[],e.id]),a&&(n.errors[a]=[...n.errors[a]??[],e.label||e.id])}}d(),e("navigation.notifications.success-detach","navigation.notifications.error-detach",n),o(B());const h=a.path.filter((e=>!c.includes(e.id)));o(F(h))},"aria-label":"detach-selection",icon:t.jsx(z,{}),title:n("navigation.actions.detach-selected")})}const Je=s`
    mutation MOVE_TREE_ELEMENT($treeId: ID!, $nodeId: ID!, $parentTo: ID, $order: Int) {
        treeMoveElement(treeId: $treeId, nodeId: $nodeId, parentTo: $parentTo, order: $order) {
            id
        }
    }
`;function qe({allowedLibraries:e,parent:n,onMessages:r}){const{t:a}=i(),{selectionState:o}=R((e=>({selectionState:e.selection,navigation:e.navigation}))),s=M(),[l]=L(),[d]=c(Je),{refreshTreeContent:h}=He(l.id);return o.selection.selected.some((i=>e.includes(i.library)))?t.jsx(be,{onClick:async()=>{var i,t;const a={countValid:0,errors:{}},c=(null==n?void 0:n.id)??null,v=o.selection.selected.filter((i=>e.includes(i.library)));for(const e of v)try{await d({variables:{treeId:l.id,nodeId:e.nodeId,parentTo:c}}),a.countValid++}catch(u){if(u.graphQLErrors&&u.graphQLErrors.length){const n=null==(i=u.graphQLErrors[0].extensions.fields)?void 0:i.parent,r=null==(t=u.graphQLErrors[0].extensions.fields)?void 0:t.element;n&&(a.errors[n]=[...a.errors[n]??[],e.id]),r&&(a.errors[r]=[...a.errors[r]??[],e.label||e.id])}}h(),r("navigation.notifications.success-move","navigation.notifications.error-move",a),s(B())},icon:t.jsx(we,{}),"aria-label":"move-selection",title:a("navigation.actions.move-selected")}):null}function Xe({parent:e,allowedChildrenLibraries:i,onMessages:n}){const{selectionState:r}=R((e=>({selectionState:e.selection,navigation:e.navigation}))),a=!!r.selection.selected.length,[o]=L(),s=r.selection.type===O.navigation,l=r.selection.type===O.navigation&&r.selection.parent===(null==e?void 0:e.id),d=e?e.permissions.edit_children:o.permissions.edit_children;return a?t.jsxs(t.Fragment,{children:[!l&&d&&t.jsx(Ue,{parent:e,allowedLibraries:i,onMessages:n}),s&&d&&!l&&t.jsx(qe,{parent:e,allowedLibraries:i,onMessages:n}),s&&t.jsx(Ye,{onMessages:n})]}):null}function Ze({depth:e,isDetail:n}){const{t:r}=i(),a=R((e=>e.navigation)),o=M(),[s]=L(),l=e,d=a.path[l-1],{libraries:c}=Ne(null==s?void 0:s.id,d),h=c.map((e=>e.library.id)),v=(e,i,t)=>{if(t.countValid){const i={channel:S.trigger,type:V.success,content:r(e,{nb:t.countValid})};o(T(i))}delete t.countValid;const n=Object.keys(t.errors);for(const a of n){const e={channel:S.trigger,type:V.warning,content:r(i,{elements:t.errors[a].reduce(((e,i)=>e?`${e}, ${i}`:`${i}`),""),errorMessage:a})};o(T(e))}};return s?t.jsxs(be.Group,{style:{height:"30px"},children:[t.jsx(Xe,{parent:d,allowedChildrenLibraries:h,onMessages:v}),t.jsx(Ge,{parent:d,isDetail:n,allowedChildrenLibraries:c,onMessages:v})]}):null}const ei=pe.header`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: ${r.secondaryBg};
    height: 4rem;
    flex-shrink: 0;
    cursor: pointer;
    max-width: ${r.navigationColumnWidth};

    &:not(:hover) .select-all-checkbox {
        visibility: hidden;
    }
`;function ii({depth:e,isDetail:n,isActive:r,treeElement:a,children:o}){const{t:s}=i(),{navigation:l,selectionState:d}=R((e=>({navigation:e.navigation,selectionState:e.selection}))),c=M(),h=e,[v]=L(),u=d.selection.selected.length,g=l.path[h-1],m=(null==a?void 0:a.record)?a.record.whoAmI.label||a.record.id:(null==v?void 0:v.label)||(null==v?void 0:v.id);return t.jsxs(ei,{onClick:()=>{r||c(F(g?l.path.slice(0,h):[]))},$isActive:r,children:[u&&r?t.jsxs(C,{title:s("navigation.header.nb-selection",{nb:u,selectionType:s(`search.type.${O[d.selection.type]}`)}),placement:"right",children:[s("navigation.header.selection_label",{count:u}),t.jsx(be,{icon:t.jsx(Ee,{}),"aria-label":"clear-selection",onClick:()=>{c(B())},style:{border:"none",color:"#000"},ghost:!0})]}):t.jsxs(t.Fragment,{children:[r&&!!(null==a?void 0:a.childrenCount)&&t.jsx(p,{className:"select-all-checkbox",onClick:()=>{const e=o.filter((e=>e.permissions.access_tree)).map((e=>({id:e.record.whoAmI.id,nodeId:e.id,library:e.record.whoAmI.library.id,label:e.record.whoAmI.label})));c(H({type:O.navigation,selected:e,parent:(null==a?void 0:a.id)??null}))}}),t.jsx(ce,{ellipsis:{tooltip:m,rows:1},style:{marginBottom:0,marginRight:".5em"},children:m})]}),r&&t.jsx(Ze,{depth:e,isDetail:n})]})}const ti=pe.div`
    position: relative;
    display: grid;

    place-items: flex-start;
    align-items: center;
    max-width: ${r.navigationColumnWidth};
    overflow: hidden;

    grid-template-columns: ${e=>((e,i)=>{let t=[];return e&&(t=["1rem"]),i||(t=[...t,"1rem"]),t=[...t,"auto","auto","1rem"],t.join(" ")})(e.$isActive,e.$isRecordActive)};
    padding: 1rem 0.5rem;
    background: ${e=>e.$isInPath?r.activeColor:"none"};

    &:hover {
        ${e=>e.$isInPath?"":`background: ${r.activeColor}`};

        .checkbox-wrapper {
            opacity: 1;
        }
    }

    .counter {
        justify-self: flex-end;
    }

    &:not(:hover) .floating-menu {
        display: none;
    }
`,ni=pe.div`
    min-width: 0;
    width: 100%;
    padding-right: 0.2rem;

    & > * > * {
        justify-content: space-around;
    }
`,ri=pe.div`
    opacity: ${({$selectionActive:e})=>e?1:0};
    transition: 100ms ease;

    :hover {
        opacity: 1;
    }
`;function ai({isActive:n,treeElement:a,depth:o}){const{lang:s}=d(),{t:l}=i(),{selectionState:c,navigation:h}=R((e=>({selectionState:e.selection,navigation:e.navigation}))),v=M(),[u,p]=e.useState(!1),[x]=L(),y=h.path[o-1],j=a.record.whoAmI.label,w=a.permissions.access_tree,I=()=>{p(!0)},$={...a.record.whoAmI,label:j??""},k=h.path.some((e=>e.id===a.id)),_=c.selection.selected.some((e=>e.nodeId===a.id)),S=a.record.active,V="middle",T=[{title:l("global.details"),button:t.jsx(he,{shape:"circle",record:$,size:V})}],D=w?[{title:l("navigation.actions.details"),icon:t.jsx(Q,{}),onClick:()=>{const e=[...h.path.slice(0,o),{...a,showDetails:!0}];v(F(e))}},{title:l("navigation.actions.classified_in"),icon:t.jsx(oe,{}),onClick:()=>E.warning(l("global.feature_not_available"))}]:[];(null==x?void 0:x.behavior)===fe.files&&D.push({title:l("files.generate_previews"),icon:t.jsx(g,{}),onClick:I});const z=N(x);return t.jsxs(ti,{onClick:()=>{if(!w)return;const e=[...h.path.slice(0,o),{...a}];v(F(e))},$isInPath:k,$isActive:n,$isRecordActive:S,children:[t.jsx(m,{actions:T,moreActions:D,style:{right:"15px"},size:V}),!w&&t.jsx(C,{title:l("navigation.access_denied"),children:t.jsx(_e,{})}),n&&w&&t.jsx(ri,{onClick:e=>{e.preventDefault(),e.stopPropagation()},className:"checkbox-wrapper",$selectionActive:!!c.selection.selected.length,children:t.jsx(ve,{onClick:e=>{e.preventDefault(),e.stopPropagation();if(c.selection.selected.find((e=>e.nodeId===a.id))){const e=c.selection.selected.filter((e=>e.nodeId!==a.id)),i={type:O.navigation,selected:e,parent:null==y?void 0:y.id};v(H(i))}else{const e=A(a.record.whoAmI.label,s),i={id:a.record.whoAmI.id,nodeId:a.id,library:a.record.whoAmI.library.id,label:e};let t=[i];c.selection.type===O.navigation&&(null==y?void 0:y.id)===c.selection.parent&&(t=[...c.selection.selected,i]);const n={type:O.navigation,selected:t,parent:null==y?void 0:y.id};v(H(n))}},checked:_})}),!S&&t.jsx(C,{title:l("navigation.inactive_element"),children:t.jsx(b,{style:{color:r.errorColor,fontSize:"1.3em",marginLeft:"0.5rem"}})}),t.jsx(ni,{children:t.jsx(W,{record:$,size:P.small})}),!!a.childrenCount&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"counter",children:t.jsx(f,{count:a.childrenCount,overflowCount:1e3,style:{background:r.secondaryBg,color:r.defaultTextColor}})}),t.jsx("div",{children:w&&t.jsx(K,{})})]}),u&&t.jsx(de,{filesLibraryId:z,libraryId:$.library.id,recordIds:[$.id],onClose:()=>{p(!1)}})]})}const oi=pe.div`
    border-right: 1px solid ${r.borderLightColor};
    width: ${r.navigationColumnWidth};
    height: 100%;
    display: flex;
    flex-flow: column nowrap;
    flex-shrink: 0;

    background: ${r.defaultBg};
`,si=pe.div`
    overflow-y: auto;
    height: 100%;
`,li=pe(j)`
    && {
        text-align: center;
        padding: 0.5em 0;
        border-bottom: 1px solid ${r.borderColor};
    }
`,di=({treeId:i,treeElement:n,depth:r,isActive:a})=>{const[s,l]=e.useState(1),[d,c]=e.useState(0),h=M(),{navigation:v}=R((e=>({navigation:e.navigation}))),u={treeId:i,node:(null==n?void 0:n.id)??null,pagination:{limit:G,offset:(s-1)*G}},{loading:g,error:p,data:m,refetch:b,called:f}=o(ue,{variables:u,onCompleted:e=>{c(e.treeNodeChildren.totalCount)}});(e=>{const{filters:i,skip:t,onData:n}=e;k(Ve,{variables:{filters:i},skip:t,onData:n})})({filters:{ignoreOwnEvents:!0,treeId:i,nodes:[(null==n?void 0:n.id)??null]},skip:g,onData(){b(u)}});const j=e.createRef();e.useEffect((()=>{var e,i;(null==(e=null==j?void 0:j.current)?void 0:e.scrollIntoView)&&a&&(null==(i=j.current)||i.scrollIntoView({behavior:"smooth",block:"end"}))}),[j,a]),e.useEffect((()=>{f&&b(u)}),[s]);const w=(null==m?void 0:m.treeNodeChildren.list)??[],I=!p,C=n&&(!g&&!d||n.showDetails);return t.jsxs(oi,{ref:j,"data-testid":"navigation-column"+(C?"-with-details":""),$showDetails:C,children:[t.jsx(ii,{depth:r,treeElement:n,isActive:a,isDetail:C,children:w}),p&&t.jsx(x,{message:p.message}),I&&C&&t.jsx(ze,{treeElement:n,closable:!!(null==n?void 0:n.childrenCount),onClose:()=>{const e=v.path.findIndex((e=>e.id===(null==n?void 0:n.id))),i=[...v.path];i[e]={...n,showDetails:!1},h(F(i))}}),I&&t.jsxs(t.Fragment,{children:[d>G&&t.jsx(li,{simple:!0,current:s,total:d,onChange:e=>{l(e)},pageSize:G}),g?t.jsx(y,{}):t.jsx(si,{children:w.map((e=>t.jsx(ai,{treeElement:e,depth:r,isActive:a},e.id)))})]})]})},ci=pe.div`
    width: auto;
    height: calc(100vh - 3rem);
    display: flex;
    flex-flow: row nowrap;
    overflow-x: scroll;
    overflow-y: hidden;
`;function hi({tree:i}){const n=R((e=>e.navigation)),r=M();e.useEffect((()=>{r(U(i))}),[i,r]);const a=0===n.path.length;return t.jsxs(ci,{children:[t.jsx(di,{treeId:i,treeElement:null,depth:0,isActive:a},"__root__"),n.path.map(((e,r)=>t.jsx(di,{treeId:i,treeElement:e,depth:r+1,isActive:r===n.path.length-1},`${e.record.id}`)))]})}function vi({tree:n}){var r,a,s;const{t:l}=i(),c=Y(),h=M(),{activePanel:v}=R((e=>e)),{lang:u}=d(),[g,p]=L(),{data:m,loading:b,error:f}=o(Z,{variables:{filters:{id:[n]}},skip:!n}),j=null==(r=null==m?void 0:m.trees)?void 0:r.list[0],I=null==(s=null==(a=null==m?void 0:m.trees)?void 0:a.list[0])?void 0:s.permissions.access_tree,C=J(c.currentApp,n);return ge({libraries:((null==j?void 0:j.libraries)??[]).map((e=>e.library.id))},!j||!C),e.useEffect((()=>{var e;if(v!==q.TREE||!I)return;const i=null==(e=null==m?void 0:m.trees)?void 0:e.list[0];if(!b&&i){const e=A(i.label,u);p({id:i.id,label:e,behavior:i.behavior,libraries:i.libraries.map((e=>({id:e.library.id,behavior:e.library.behavior}))),permissions:i.permissions});const t={content:l("info.active-tree",{tree:e,appLabel:A(c.currentApp.label,u),interpolation:{escapeValue:!1}}),type:V.basic};h(X(t))}}),[m,b,u,p,l,h,v,g,n,I]),b?t.jsx(y,{"data-testid":"loading"}):f?t.jsx(x,{message:f.message}):I?C?t.jsx(hi,{tree:n}):t.jsx(x,{message:l("navigation.not_in_app")}):t.jsx(x,{type:w.PERMISSION_ERROR})}export{vi as default};
